<!DOCTYPE html>
<html>
  <head>
    <title>Weather App</title>
    <meta charset="UTF-8" />

   
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous"
    />
    <script src="https://unpkg.com/axios@1.1.2/dist/axios.min.js"></script>
  </head>

  <body>
    <section class="vh-100" style="background: linear-gradient(70.6deg, rgb(172, 30, 255) 0.3%, rgb(65, 35, 251) 55.8%, rgb(35, 251, 224) 105.1%);">
      <div class="container py-5 h-100">
    
        <div class="row d-flex justify-content-center align-items-center h-100" >
          <div class="col-md-10 col-xl-7" >
    
            <div class="card" style="color: #4B515D; border-radius: 35px; background-image: url('photo.jpg');">
              <div class="card-body p-4">
    
                <div class="d-flex">
                  <h6 class="flex-grow-1"><span style="font-weight: bold; margin:0px 0px 20px 15px;color: black; opacity: 0.8">
                  <div class="ll" style="margin:0px 0px 0px 25px"> Kolkata </div></span></h6>
                  <h6><div style="margin:20px 50px 15px 15px; font-weight:bold" class="r_time"> </div> </h6>
                </div>
                <div >
                  <form id="loc" > 
                    <div class="row">
                      <div class="col-8">
                          <input type="search" id="search" placeholder="Enter your city" class="form-control rounded">  
                      </div>
                      <div class="col-2">
                          <input type="submit" value="Search" class="btn btn-dark" style="margin:0px 0px" > 
                      </div>
                      <div class="col-2">
                          <button type="button" id="geol" class="btn btn-success" style="margin:0px 5px; padding: 6px 9px ">Current</button>
                      </div>
                    </div>
                        </form>
                      </div>
                <div style="margin:10px 10px 0px 10px">
                  <img src="https://www.freeiconspng.com/thumbs/sunny-icon/sunny-icon-17.png" alt="broken-clouds-night" id="icon" class="temperature-icon" width="100px">
                </div>
                <div class="imp" style="display:inline; ">
                  <div class="row">
                    <div class="col-8">
                <h6 style="margin:20px 0px 0px 0px; font-weight: 400px; color: black" >
                   <div class="curr_loc">
                  Kolkata, Pandit Satghara, West Bengal
                   </div>
                    <div class="current_time">
                    
                    </div>
                   <div id="des"> Sunny </div>
                </h6>
              </div>
                    <div class="col-4">
                  <h6 class=" font-weight-bold" style="color: #1C2331; font-size:30px;"><span id="change"> 23</span>
                     <span style="font-size: 1rem; position:relative; top: -12px; text-decoration-line: none" id="link"> 
                      <a href="#" id="celsius-link" style="text-decoration: none">°C</a>
                      |<a href="#" id="fahrenheit-link" style="text-decoration: none" >°F</a>
                     </span>
                    
                  </h6>
                  <span class="small" style="color: #0D2544; font-weight:bold; font-family:Times; font-size: 15px "><span id="pre"> Pressure: 1004 Pa</span><div>

                     <span id="hum"> Humidity: 65% </span></div>
                      <div>
                      <span id="wind"> Wind: 0 km/h </span></div>
                         </span>
                </div>
                </div>
                <br>
                    <div style="background: linear-gradient(to top, #295083 0%, #84a2ba 100%); border-radius: 15px;border-style: solid;
  border-width: 4px; padding: 21px;border-color: #153a6b;  color: white; margin:0px 15px">
                      <div class="forecast" id="weather-forecast"><div class="row"><div class="col">
                <div class="forecast-temp">
                  <span class="forecast-temp-max">27° / </span><span class="forecast-temp-min"> 17°</span>
                </div>
                <img src="http://shecodes-assets.s3.amazonaws.com/api/weather/icons/few-clouds-day.png" class="forecast-icon">
                
                <div class="forecast-date">Thu</div>
              </div>
            <div class="col">
                <div class="forecast-temp">
                  <span class="forecast-temp-max">22° / </span><span class="forecast-temp-min"> 15°</span>
                </div>
                <img src="http://shecodes-assets.s3.amazonaws.com/api/weather/icons/rain-day.png" class="forecast-icon">
                
                <div class="forecast-date">Fri</div>
              </div>
            <div class="col">
                <div class="forecast-temp">
                  <span class="forecast-temp-max">24° /</span><span class="forecast-temp-min"> 16°</span>
                </div>
                <img src="http://shecodes-assets.s3.amazonaws.com/api/weather/icons/broken-clouds-day.png" class="forecast-icon">
                <div class="forecast-date">Sat</div>
              </div>
            <div class="col">
                <div class="forecast-temp">
                  <span class="forecast-temp-max">22° /</span><span class="forecast-temp-min"> 15°</span>
                </div>
                <img src="http://shecodes-assets.s3.amazonaws.com/api/weather/icons/broken-clouds-day.png" class="forecast-icon">
                <div class="forecast-date">Sun</div>
              </div>
            <div class="col">
                <div class="forecast-temp">
                  <span class="forecast-temp-max">25° / </span><span class="forecast-temp-min"> 13°</span>
                </div>
                <img src="http://shecodes-assets.s3.amazonaws.com/api/weather/icons/clear-sky-day.png" class="forecast-icon">
                <div class="forecast-date">Mon</div>
              </div>
            </div>
          </div>
                </div>
                    
                   
                  <small>
                  <a href="https://github.com/megha-ghosh109/weather-app" target="_blank" style="text-align: center; text-decoration: none;display: block; color: #0b1e32; padding: 10px 0px 0px 0px;font-family:'Noto Sans';font-weight: 600;">Open-source code by Megha Ghosh </a>
                </small>
              </div>
            </div>
    
          </div>
        </div>
    
      </div>
    </section>
<script>
let now = new Date();

let days = [
  "Sunday",
  "Monday",
  "Tuesday",
  "Wednesday",
  "Thursday",
  "Friday",
  "Saturday",
];
let day = days[now.getDay()];
console.log(day);

let hours = [now.getHours()];
if (hours < 10) {
  hours = `0${hours}`;
}
let minuites = [now.getMinutes()];
if (minuites < 10) {
  minuites = `0${minuites}`;
}
let time = hours + ":" + minuites;
console.log(time);
let curr_time = `${day}, ${time}`;
console.log(curr_time);

let now_t = document.querySelector("div .current_time");
console.log(now_t);
now_t.innerHTML = curr_time;
let now_rtd = document.querySelector("div .r_time");
console.log(now_rtd);
now_rtd.innerHTML = time;



function location_geo(event) {
  event.preventDefault();
  navigator.geolocation.getCurrentPosition(curlocation);
}

function curlocation(position) {
  console.log(position.coords.latitude);
  console.log(position.coords.longitude);
  let apiKey = "8ca7dd4e61360b90fb66918853670e48";
  let lat = position.coords.latitude;
  let lon = position.coords.longitude;
  let apiURL = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${apiKey}`;
  axios.get(apiURL).then(tempr);
}
//search
function getForecast_(coordinates) {
  
  let apiKey = "8ca7dd4e61360b90fb66918853670e48";
  
  let apiUrl = `https://api.openweathermap.org/data/2.5/onecall?lat=${coordinates.lat}&lon=${coordinates.lon}&appid=${apiKey}&units=metric`;
  console.log(apiUrl);
  axios.get(apiUrl).then(displayForecast_);

}
  function displayForecast_(response) {
  let forecast = response.data.daily;
  let foreCastElement = document.querySelector("#weather-forecast");

  let forecastHTML = `<div class="row">`;

  forecast.forEach(function (forecastDay, index) {
    if (index < 5) {
      forecastHTML =
        forecastHTML +
        `
    <div class="col">
      <div class="forecast-date">${formatDay_(forecastDay.dt)}</div>
      <img
        src="http://openweathermap.org/img/wn/${
          forecastDay.weather[0].icon
        }@2x.png"
        alt=""
        width="67"
        class="forecast-icon" 
      />
      <div class="forecast-temp">
        <span class="forecast-temp-max"> ${Math.round(
          forecastDay.temp.max
        )} ° /</span>
        <span class="forecast-temp-min"> ${Math.round(
          forecastDay.temp.min
        )} ° </span>
      </div>
    </div>`;
    }
  });

  forecastHTML = forecastHTML + `</div>`;
  foreCastElement.innerHTML = forecastHTML;
}
function formatDay_(timestamp) {
  let date = new Date(timestamp * 1000);
  let day = date.getDay();
  let days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

  return days[day];
}
function tempr(response) {
  console.log(response.data.main.temp);
  let loc_d = document.querySelector("div .curr_loc");
  let loc_p = document.querySelector("div .ll");
  loc_d.innerHTML = response.data.name;
  loc_p.innerHTML = response.data.name;
  let temp_r = document.querySelector("#change");
  temp_r.innerHTML = Math.round(response.data.main.temp);
  let hum = document.querySelector("#hum");
  hum.innerHTML = `Humidity: ${response.data.main.humidity}%`;
  let wind = document.querySelector("#wind");
  wind.innerHTML = `Wind: ${response.data.wind.speed} km/h`;
  let pres = document.querySelector("#pre");
  pres.innerHTML = `Pressure: ${response.data.main.pressure} Pa`;
  let desc = document.querySelector("#des");
  desc.innerHTML = response.data.weather[0].main;
   let iconElement = document.querySelector("#icon");
   iconElement.setAttribute(
    "src",
    `https://openweathermap.org/img/wn/${response.data.weather[0].icon}@2x.png`
  );
  iconElement.setAttribute("alt", response.data.weather[0].description);
  getForecast_(response.data.coord);
   
  function hlink(event) {
    event.preventDefault();
    let f_link = document.querySelector("#fahrenheit-link");
    let ff_link = document.querySelector("#change");
    let fahrenheitTemperature = Math.round(
      (response.data.main.temp * 9) / 5 + 32
    );
    ff_link.innerHTML = fahrenheitTemperature;
  }

  let link_ = document.querySelector("#fahrenheit-link");
  link_.addEventListener("click", hlink);

  function c_link(event) {
    event.preventDefault();
    let cc_link = document.querySelector("#celsius-link");
    let ccc_link = document.querySelector("#change");
    ccc_link.innerHTML = Math.round(response.data.main.temp);
  }
  let linkc_ = document.querySelector("#celsius-link");
  linkc_.addEventListener("click", c_link);
}
function displayForecast(response) {
  let forecast = response.data.daily;
  let forecastElement = document.querySelector("#weather-forecast");

  let forecastHTML = `<div class="row">`;
  forecast.forEach(function (forecastDay, index) {
    if (index < 5) {
      forecastHTML =
        forecastHTML +
        `<div class="col">
                <div class="forecast-temp">
                    <span class="forecast-temp-max">  ${Math.round(
                    forecastDay.temperature.maximum
                  )}° / </span
                  ><span class="forecast-temp-min"> ${Math.round(
                    forecastDay.temperature.minimum
                  )}°</span>
                </div>
                <img src="${
                  forecastDay.condition.icon_url
                }" class="forecast-icon" margin="90" />
                
                <div class="forecast-date">${formatDay(forecastDay.time)}</div>
              </div>
            `;
    }
  });

  forecastHTML = forecastHTML + `</div>`;
  forecastElement.innerHTML = forecastHTML;
}
function formatDay(timestamp) {
  let date = new Date(timestamp * 1000);
  let day = date.getDay();
  let days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
  return days[day];
}

function getForecast(coordinates) {
  let apiKey = "3cc69f23b02f88a0t0o74cabe15fabf9";
  let apiUrl = `https://api.shecodes.io/weather/v1/forecast?lon=${coordinates.longitude}&lat=${coordinates.latitude}&key=${apiKey}&units=metric`;

  axios.get(apiUrl).then(displayForecast);
}
function temp(response) {
  console.log(response.data);
  let loc_d = document.querySelector("div .curr_loc");
  let loc_p = document.querySelector("div .ll");
  loc_d.innerHTML = response.data.city;
  loc_p.innerHTML = response.data.city;
  let temp_r = document.querySelector("#change");
  temp_r.innerHTML = Math.round(response.data.temperature.current);
  let hum = document.querySelector("#hum");
  hum.innerHTML = `Humidity: ${response.data.temperature.humidity}%`;
  let wind = document.querySelector("#wind");
  wind.innerHTML = `Wind: ${response.data.wind.speed} km/h`;
  //let pres = document.querySelector("#pre");
  //pres.innerHTML = `Pressure: ${response.data.main.pressure} Pa`;
  let desc = document.querySelector("#des");
  desc.innerHTML = response.data.condition.description;
  let iconElement = document.querySelector("#icon");
   iconElement.setAttribute("src", `${response.data.condition.icon_url}`);
  iconElement.setAttribute("alt", response.data.condition.icon);
   getForecast(response.data.coordinates);
  function hlink(event) {
    event.preventDefault();
    let f_link = document.querySelector("#fahrenheit-link");
    let ff_link = document.querySelector("#change");
    let fahrenheitTemperature = Math.round(
      ( response.data.temperature.current* 9) / 5 + 32
    );
    ff_link.innerHTML = fahrenheitTemperature;
  }

  let link_ = document.querySelector("#fahrenheit-link");
  link_.addEventListener("click", hlink);

  function c_link(event) {
    event.preventDefault();
    let cc_link = document.querySelector("#celsius-link");
    let ccc_link = document.querySelector("#change");
    ccc_link.innerHTML = Math.round(response.data.temperature.current);
  }
  let linkc_ = document.querySelector("#celsius-link");
  linkc_.addEventListener("click", c_link);
  
}


  function locations(event) {
  event.preventDefault();
  let l_loc = document.querySelector(" #search");
  let loc_s = document.querySelector("div .curr_loc");
  loc_s.innerHTML = l_loc.value;
  let loc_up = document.querySelector("div .ll");
  loc_up.innerHTML = l_loc.value;
  
  let city = l_loc.value;
  let apiKey = "3cc69f23b02f88a0t0o74cabe15fabf9";
  let url = `https://api.shecodes.io/weather/v1/current?query=${city}&key=${apiKey}&units=metric`;
  axios.get(url).then(temp);
    }
  


let button_g = document.querySelector("#geol");
button_g.addEventListener("click", location_geo);

let cur_loc = document.querySelector("#loc");
cur_loc.addEventListener("submit", locations);

</script>
</body>
</html>
